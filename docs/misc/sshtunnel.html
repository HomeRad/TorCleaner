<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.1: http://docutils.sourceforge.net/" />
<title>SSH tunnel</title>
<meta content="SSH tunnel" name="navigation.name" />
<link rel="stylesheet" href="../wc.css" type="text/css" />
<link rel="stylesheet" href="../navigation.css" type="text/css" />
<script type="text/javascript">
window.onload = function() {
  if (top.location != location) {
    top.location.href = document.location.href;
  }
}
</script>
</head>
<body>
<!-- bfknav -->
<div class="navigation">
<div class="navrow" style="padding: 0em 0em 0em 1em;">
<a href=".././index.html">WebCleaner</a>
<a href=".././faq.html">FAQ</a>
<a href=".././install.html">Installation</a>
<a href=".././devel/devel.html">Development &gt;</a>
<span>Examples &gt;</span>
</div>
<div class="navrow" style="padding: 0em 0em 0em 2em;"><a href=".././misc/squid.html">Squid configuration</a>
<span>SSH tunnel</span>

</div>
</div>
<!-- /bfknav -->
<div class="document" id="ssh-tunnel">
<h1 class="title">SSH tunnel</h1>
<p>Here are some scripts (for Debian Linux systems) to let you use WebCleaner
over ssh and dialup from your box at work (my.atworkbox.com) to your box
at home (my.homedslbox.org).</p>
<p>Remember: do not open port 8080 in your home-firewall for this to work.
If you do not have a firewall on your home dsl box or don't know what I
am talking about, leave these scripts alone!</p>
<ol class="arabic">
<li><p class="first">Put this iptables line in your firewall at my.homedslbox.org:</p>
<pre class="literal-block">
$IPTABLES -A INPUT -i ppp0 -p tcp -s my.atworkbox.com --dport ssh -m state --state NEW -j ACCEPT
</pre>
<p>This assumes your ppp interface is ppp0. And you must have state
matching enabled in your kernel.</p>
</li>
<li><p class="first">copy this script on my.homedslbox.org:</p>
<pre class="literal-block">
-- start file /etc/ppp/ip-up.d/30webcleaner --
# add external IP to the allowed host list
# tested under Debian Linux
#!/bin/sh
D=/etc/webcleaner
O=$D/webcleaner.conf
N=$D/webcleaner.new
R=&quot;s/^ allowedhosts=.*/ allowedhosts=\&quot;localhost,$PPP_LOCAL\&quot;/&quot;
test -f $O || exit 0
rm -f $N
sed  -e &quot;$R&quot; $O &gt; $N
mv -f $N $O
/etc/init.d/webcleaner reload
-- end file /etc/ppp/ip-up.d/30webcleaner --
</pre>
</li>
<li><p class="first">copy this script on your work box my.atworkbox.com:</p>
<pre class="literal-block">
-- start file ~/bin/f.sh --
#!/bin/sh
ssh -C -2 -L 8080:my.homedslbox.org:8080 my.homedslbox.org
-- end file ~/bin/f.sh --
</pre>
</li>
<li><p class="first">Start your home box, start webcleaner, then start your network with &quot;pon&quot;.
The script 30webcleaner gets executed.</p>
</li>
<li><p class="first">Go to work, start script f.sh and you can surf with this setting:
<tt class="literal"><span class="pre">export</span> <span class="pre">http_proxy=&quot;localhost:8080&quot;</span></tt> :-)</p>
</li>
</ol>
</div>
<hr class="footer" />
<div class="footer">
Generated on: 2004-04-25 08:57 UTC.
</div>
</body>
</html>

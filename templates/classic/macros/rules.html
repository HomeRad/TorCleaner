<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="copyright" content="(C) 2004 Bastian Kleineidam">
<link href="../wc.css" type="text/css" rel="Stylesheet">
<title>Rule macros</title>
</head>
<body>
<div class="content">
<h1>Rule macros...</h1>
<!-- macro definitions for rule editing
  Note: the TAL contexts from the calling templates are used here
 -->

<!-- regular expression footnote -->
<div metal:define-macro="regexfoot">
<div class="footnote">
<sup id="footnote1" title="footnote 1"
 i18n:attributes="title">1)</sup>
<span i18n:translate="">The supplied value resembles a
<a href="http://www.amk.ca/python/howto/regex/">regular expression</a>.</span>
</div>
</div>

<!-- title and description (used below) -->
<h2>Title and description</h2>
<table summary="">
<div metal:define-macro="titledesc">
<tr valign="top"><td>
<label for="rule_title" i18n:translate="">Title</label>:
</td><td>
<input type="text" class="text" name="rule_title" id="rule_title"
 value="Rule title" tal:attributes="value currule/titles/?lang">
</td></tr>
<tr valign="top"><td>
<label for="rule_description" i18n:translate="">Description</label>:
</td><td>
<textarea name="rule_description" id="rule_description" cols="50" rows="5"
 tal:content="currule/descriptions/?lang">Rule description</textarea>
</td></tr>
</div>
</table>
<hr noshade size="1">

<!-- matchurl and dontmatchurl (used below) -->
<h2>Match url</h2>
<table summary="">
<div metal:define-macro="matchurl">
<tr valign="top"><td>
<label for="rule_matchurls" i18n:translate="">Match urls</label><sup><a
 href="#footnote1" class="footnote" title="see footnote 1"
 i18n:attributes="title">1)</a></sup>:
</td><td>
<select name="rule_matchurls" id="rule_matchurls" multiple size="3"
 i18n:attributes="title"
 title="List of urls this rule should apply to">
<option tal:repeat="url currule/matchurls" tal:attributes="value url"
 tal:content="url">www\.imadoofus\.org</option>
</select><br>
<input type="submit" name="delmatchurls" value="Remove selected" class="submit"
 i18n:attributes="value"><br>
<input class="text" type="text" name="newmatchurl" value=""><br>
<input type="submit" name="addmatchurl" value="Add new" class="submit"
 i18n:attributes="value">
</td></tr>
<tr valign="top"><td>
<label for="rule_nomatchurls" i18n:translate="">Don't match urls</label><sup><a
 href="#footnote1" class="footnote" title="see footnote 1"
 i18n:attributes="title">1)</a></sup>:
</td><td>
<select name="rule_nomatchurls" id="rule_nomatchurls" multiple size="3"
 i18n:attributes="title"
 title="List of urls this rule must not apply to">
<option tal:repeat="url currule/nomatchurls" tal:attributes="value url"
 tal:content="url">www\.imadoofus\.org</option>
</select><br>
<input type="submit" name="delnomatchurls" value="Remove selected"
 class="submit" i18n:attributes="value"><br>
<input class="text" type="text" name="newnomatchurl" value=""><br>
<input type="submit" name="addnomatchurl" value="Add new" class="submit"
 i18n:attributes="value">
</td></tr>
</div>
</table>

<hr noshade size="1">

<!-- url parts (used by AllowRule and BlockRule) -->
<h2>Url parts</h2>
<table summary="">
<div metal:define-macro="urlparts">
<tr valign="top"><td>
<label for="rule_url" i18n:translate="">URL</label><sup><a
 href="#footnote1" class="footnote" title="see footnote 1"
 i18n:attributes="title">1)</a></sup>:
</td><td>
<input type="text" class="text" name="rule_url" value=""
 tal:attributes="value currule/url">
</td></tr>
</div>
</table>
<hr noshade size="1">

<!-- externfile (used by Allowdomains, Allowurls, Blockdomains, Blockurls) -->
<h2>Extern file</h2>
<table summary="">
<div metal:define-macro="externfile">
<tr valign="top"><td>
<span i18n:translate="">Title</span>:
</td><td>
<span tal:replace="currule/titles/?lang">rule title</span>
</td></tr>
<tr valign="top"><td>
<span i18n:translate="">Description</span>:
</td><td>
<span tal:replace="currule/descriptions/?lang">rule description</span>
</td></tr>
<tr valign="top"><td>
<span i18n:translate="">Filename</span>:
</td><td>
<span tal:replace="currule/filename">/path/to/file</span>
</td></tr>
</div>
</table>
<hr noshade size="1">


<!-- Rule macros, each in a table tag -->

<!-- AllowRule -->
<h2>Allowrule</h2>
<table metal:define-macro="allow" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr metal:use-macro="rulemacros/urlparts">
Rule url parts
</tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- Allowdomains -->
<h2>Allowdomains</h2>
<table metal:define-macro="allowdomains" summary="">
<tr metal:use-macro="rulemacros/externfile">
Extern file name allowdomains
</tr>
</table>
<hr noshade size="1">

<!-- Allowurls -->
<h2>Allowurls</h2>
<table metal:define-macro="allowurls" summary="">
<tr metal:use-macro="rulemacros/externfile">
Extern file name allowurls
</tr>
</table>
<hr noshade size="1">

<!-- Blockdomains -->
<h2>Blockdomains</h2>
<table metal:define-macro="blockdomains" summary="">
<tr metal:use-macro="rulemacros/externfile">
Extern file name blockdomains
</tr>
</table>
<hr noshade size="1">

<!-- Blockurls -->
<h2>Blockurls</h2>
<table metal:define-macro="blockurls" summary="">
<tr metal:use-macro="rulemacros/externfile">
Extern file name blockurls
</tr>
</table>
<hr noshade size="1">

<!-- BlockRule -->
<h2>BlockRule</h2>
<table metal:define-macro="block" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr metal:use-macro="rulemacros/urlparts">
Rule url parts
</tr>
<tr valign="top"><td>
<label for="rule_replacement" i18n:translate="">Replacement URL</label>:
</td><td>
<input type="text" class="text" name="rule_replacement" id="rule_replacement"
 value="http://www.calvinandhobbes.com/"
 tal:attributes="value currule/replacement">
</td></tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- HeaderRule -->
<h2>HeaderRule</h2>
<table metal:define-macro="header" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr valign="top"><td>
<label for="rule_headername" i18n:translate="">Header name</label>:
</td><td>
<input type="text" class="text" name="rule_headername" id="rule_headername"
 value="x-meta" tal:attributes="value currule/name">
</td></tr>
<tr valign="top"><td>
<label for="rule_headervalue" i18n:translate="">Header value</label>:
</td><td>
<input type="text" class="text" name="rule_headervalue" id="rule_headervalue"
 value="" tal:attributes="value currule/value">
</td></tr>
<tr valign="top"><td>
<label for="rule_headerfilter" i18n:translate="">Header filters</label>:
</td><td>
<select name="rule_headerfilter" id="rule_headerfilter"
 i18n:attributes="title"
 title="Header rules apply either to client request, server request or both">
<option tal:condition="not:curfilterstage/both"
 value="both" i18n:translate="">request and response</option>
<option tal:condition="curfilterstage/both" selected
 value="both" i18n:translate="">request and response</option>
<option tal:condition="not:curfilterstage/request"
 value="request" i18n:translate="">request</option>
<option tal:condition="curfilterstage/request" selected
 value="request" i18n:translate="">request</option>
<option tal:condition="not:curfilterstage/response"
 value="response" i18n:translate="">response</option>
<option tal:condition="curfilterstage/response" selected
 value="response" i18n:translate="">response</option>
</select>
</td></tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- ImageRule -->
<h2>ImageRule</h2>
<table metal:define-macro="image" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr valign="top"><td>
<label for="rule_imgwidth" i18n:translate="">Image width</label>:
</td><td>
<input type="text" class="number" name="rule_imgwidth" id="rule_imgwidth"
 value="1" tal:attributes="value string:${currule/width}">
</td></tr>
<tr valign="top"><td>
<label for="rule_imgheight" i18n:translate="">Image height</label>:
</td><td>
<input type="text" class="number" name="rule_imgheight" id="rule_imgheight"
 value="1" tal:attributes="value string:${currule/height}">
</td></tr>
<!-- XXX todo: image type select -->
<tr valign="top"><td>
<label for="rule_imgurl" i18n:translate="">Blocked image URL</label>:
</td><td>
<input type="text" class="text" name="rule_imgurl" id="rule_imgurl"
 value="myblocked.gif" tal:attributes="value currule/url">
</td></tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- ImageReduceRule -->
<h2>ImageReduceRule</h2>
<table metal:define-macro="imagereduce" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr valign="top"><td>
<label for="rule_imgquality" i18n:translate="">Image JPEG quality</label>:
</td><td>
<input type="text" class="number" name="rule_imgquality" id="rule_imgquality"
 value="20" tal:attributes="value string:${currule/quality}">
</td></tr>
<tr valign="top"><td>
<label for="rule_imgminsize" i18n:translate="">Minimum image size</label>:
</td><td>
<input type="text" class="number" name="rule_imgminsize" id="rule_imgminsize"
 value="5120" tal:attributes="value string:${currule/minimal_size_bytes}">
</td></tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- JavascriptRule -->
<h2>JavascriptRule</h2>
<table metal:define-macro="javascript" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- AntivirusRule -->
<h2>AntivirusRule</h2>
<table metal:define-macro="antivirus" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- NocommentsRule -->
<h2>NocommentsRule</h2>
<table metal:define-macro="nocomments" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- RatingRule -->
<h2>RatingRule</h2>
<table metal:define-macro="rating" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr valign="top"><td>
<label for="rule_fallback" i18n:translate="">Fallback URL</label>:
</td><td>
<input type="text" class="text" name="rule_fallback" id="rule_fallback"
 value="http://www..." tal:attributes="value currule/url">
</td></tr>
<tr valign="top"><td colspan="2">
<span i18n:translate="">Rating limits for</span>
<a href="rating.html" tal:attributes="href string:rating.html.${lang}"
 tal:content="service/name">WebCleaner</a>:
</td>
</tr>
<tr valign="top"><td colspan="2">
<table rules="cols" cellpadding="5" cellspacing="0" border="0" summary="">
<thead>
<tr style="border-bottom:1px solid black;">
<th i18n:translate="">Category</th>
<th colspan="3" i18n:translate="">Allowed limit</th>
</tr>
</thead>
<tbody>
<tr tal:repeat="category service/categories/keys">
<!-- XXX translation -->
<td
 tal:content="service/categories/?category/name">violence</td>
<td tal:condition="service/categories/?category/rrange" colspan="3">
<input type="text" size="4"
 tal:attributes="name string:category_${category};value currule/ratings/?category"
></td>
<td tal:repeat="value service/categories/?category/rvalues"><input
 tal:attributes="name string:category_${category};value value"
 tal:condition="currule/values/?category/?value" checked
 type="radio"><input
 tal:attributes="name string:category_${category};value value"
 tal:condition="not:currule/values/?category/?value"
 type="radio">&nbsp;<!-- XXX translation --><span 
 tal:content="rangenames/?value">Mild</span>
 </td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- ReplaceRule -->
<h2>ReplaceRule</h2>
<table metal:define-macro="replace" summary="">
<tr metal:use-macro="rulemacros/titledesc">
Rule title and description
</tr>
<tr metal:use-macro="rulemacros/matchurl">
Rule (don't) match url
</tr>
<tr valign="top"><td>
<label for="rule_search" i18n:translate="">Search for</label><sup><a
 href="#footnote1" class="footnote" title="see footnote 1"
 i18n:attributes="title">1)</a></sup>:
</td><td>
<input type="text" class="text" name="rule_search" id="rule_search"
 value="A nasty word" tal:attributes="value currule/search">
</td></tr>
<tr valign="top"><td>
<label for="rule_replace" i18n:translate="">Replacement</label>:
</td><td>
<input type="text" class="text" name="rule_replace" id="rule_replace"
 value="Something good" tal:attributes="value currule/replacement">
</td></tr>
<tr>
<td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

<!-- RewriteRule -->
<h2>RewriteRule</h2>
<table metal:define-macro="rewrite" summary="">
<tr metal:use-macro="rulemacros/titledesc">
<td>Rule title and description</td>
</tr>
<tr metal:use-macro="rulemacros/matchurl">
<td>Rule (don't) match url</td>
</tr>
<tr valign="top"><td>
<label for="rule_tag" i18n:translate="">Tag name</label>:
</td><td>
<input type="text" class="text" name="rule_tag" id="rule_tag" value="img"
 tal:attributes="value currule/tag">
</td></tr>
<tr valign="top"><td>
<span i18n:translate="">Attributes</span>:
</td><td>
<table rules="cols" cellpadding="2" cellspacing="0" border="0">
<thead>
<tr style="border-bottom:1px solid black;">
<td>&nbsp;</td>
<th i18n:translate="">Name</th>
<th i18n:translate="">Value</th>
</tr>
</thead>
<tbody>
<tr tal:repeat="attr currule/attrs/keys">
<td><input type="checkbox" name="delattr"
 tal:attributes="value attr">
</td>
<td tal:content="attr">href</td>
<td><div tal:content="currule/attrs/?attr" style="width:180px;overflow:auto;">bla</div></td>
</tr>
<tr tal:condition="not:currule/attrs">
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<span tal:condition="currule/attrs">
<input type="submit" class="submit" name="removeattrs"
 value="Remove selected attributes" i18n:attributes="value">
</span>
</td></tr>
<tr valign="top"><td>
<label for="attrname" i18n:translate="">Name</label>:
</td><td>
<input type="text" class="text" name="attrname" id="attrname" value="href"
 tal:condition="not:currule/attrs">
<input type="text" class="text" name="attrname" id="attrname" value=""
 tal:condition="currule/attrs">
</td></tr>
<tr valign="top"><td>
<label for="attrval" i18n:translate="">Value</label><sup><a
 href="#footnote1" class="footnote" title="see footnote 1"
 i18n:attributes="title">1)</a></sup>:
</td><td>
<input type="text" class="text" name="attrval" id="attrval" value="">
</td></tr>
<tr valign="top"><td>&nbsp;</td>
<td><input type="submit" class="submit" name="addattr"
 value="Add/replace attribute"
 i18n:attributes="value">
</td></tr>
<tr valign="top"><td>
<label for="rule_enclosedblock" i18n:translate="">Enclosed block</label>:
</td><td>
<input type="text" class="text" name="rule_enclosedblock"
 id="rule_enclosedblock" value="" tal:attributes="value currule/enclosed">
</td></tr>
<tr valign="top"><td>
<label for="rule_rewritepart" i18n:translate="">Replace part</label>:
</td><td>
<select name="rule_rewritepart">
<span tal:repeat="part partvalnames" tal:omit-tag="">
<option tal:condition="not:curparts/?part"
 tal:attributes="value part" tal:content="partnames/?part">a part</option>
<option tal:condition="curparts/?part" selected
 tal:attributes="value part" tal:content="partnames/?part">a part</option>
</span>
</select>
</td></tr>
<tr valign="top"><td>
<label for="rule_rewritereplacement" i18n:translate="">Replace value</label>:
</td><td>
<input type="text" class="text" name="rule_rewritereplacement" value=""
 id="rule_rewritereplacement" tal:attributes="value currule/replacement">
</td></tr>
<tr><td colspan="2">
<input type="submit" class="submit" name="apply" value="Apply"
 i18n:attributes="value">
<div metal:use-macro="rulemacros/regexfoot">
Regex footnote
</div>
</td></tr>
</table>
<hr noshade size="1">

</body>
</html>
